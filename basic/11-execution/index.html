<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS 运行机制 | HC的前端之旅</title>
    <meta name="description" content="Javascript, HTML, CSS, Vue, React, Flutter, NodeJs, 前端技术">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.694c5b74.css" as="style"><link rel="preload" href="/blog/assets/js/app.53d50016.js" as="script"><link rel="preload" href="/blog/assets/js/2.3ec31b7f.js" as="script"><link rel="preload" href="/blog/assets/js/11.e22e742b.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.8c9cba02.js"><link rel="prefetch" href="/blog/assets/js/12.a774b76b.js"><link rel="prefetch" href="/blog/assets/js/13.93dea613.js"><link rel="prefetch" href="/blog/assets/js/14.e0edb64a.js"><link rel="prefetch" href="/blog/assets/js/15.24f05b73.js"><link rel="prefetch" href="/blog/assets/js/16.e93c91ae.js"><link rel="prefetch" href="/blog/assets/js/17.506430c8.js"><link rel="prefetch" href="/blog/assets/js/18.ffa75666.js"><link rel="prefetch" href="/blog/assets/js/19.ba021491.js"><link rel="prefetch" href="/blog/assets/js/20.2bb97580.js"><link rel="prefetch" href="/blog/assets/js/21.b191e9df.js"><link rel="prefetch" href="/blog/assets/js/22.28225bd3.js"><link rel="prefetch" href="/blog/assets/js/23.36805c8e.js"><link rel="prefetch" href="/blog/assets/js/24.3b3d7083.js"><link rel="prefetch" href="/blog/assets/js/25.0c55a03b.js"><link rel="prefetch" href="/blog/assets/js/26.f5adbea6.js"><link rel="prefetch" href="/blog/assets/js/27.f7ccc17d.js"><link rel="prefetch" href="/blog/assets/js/28.d5d129ed.js"><link rel="prefetch" href="/blog/assets/js/29.15e86219.js"><link rel="prefetch" href="/blog/assets/js/3.2dbd99d4.js"><link rel="prefetch" href="/blog/assets/js/30.20c57fc2.js"><link rel="prefetch" href="/blog/assets/js/31.93c96ddb.js"><link rel="prefetch" href="/blog/assets/js/32.e43dcd71.js"><link rel="prefetch" href="/blog/assets/js/33.486a0696.js"><link rel="prefetch" href="/blog/assets/js/4.d168f381.js"><link rel="prefetch" href="/blog/assets/js/5.e8637279.js"><link rel="prefetch" href="/blog/assets/js/6.e2e543f3.js"><link rel="prefetch" href="/blog/assets/js/7.23803295.js"><link rel="prefetch" href="/blog/assets/js/8.15296b6c.js"><link rel="prefetch" href="/blog/assets/js/9.9e1c656a.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.694c5b74.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">HC的前端之旅</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/basic/" class="nav-link router-link-active">基础</a></div><div class="nav-item"><a href="/blog/advanced/" class="nav-link">进阶</a></div><div class="nav-item"><a href="/blog/frame/" class="nav-link">框架</a></div><div class="nav-item"><a href="/blog/other/" class="nav-link">其他</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/basic/" class="nav-link router-link-active">基础</a></div><div class="nav-item"><a href="/blog/advanced/" class="nav-link">进阶</a></div><div class="nav-item"><a href="/blog/frame/" class="nav-link">框架</a></div><div class="nav-item"><a href="/blog/other/" class="nav-link">其他</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>页面布局</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/basic/1-layout/center.html" class="sidebar-link">元素居中</a></li><li><a href="/blog/basic/1-layout/column.html" class="sidebar-link">多栏布局</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>盒模型</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog/basic/3-event/" class="sidebar-link">DOM事件</a></li><li><a href="/blog/basic/4-http/" class="sidebar-link">HTTP</a></li><li><a href="/blog/basic/5-prototype/" class="sidebar-link">原型/原型链</a></li><li><a href="/blog/basic/6-oop/" class="sidebar-link">面向对象</a></li><li><a href="/blog/basic/7-comm/" class="sidebar-link">前后端通信</a></li><li><a href="/blog/basic/8-security/" class="sidebar-link">web安全</a></li><li><a href="/blog/basic/9-algorithm/" class="sidebar-link">算法</a></li><li><a href="/blog/basic/10-rendering/" class="sidebar-link">渲染机制</a></li><li><a href="/blog/basic/11-execution/" class="active sidebar-link">JS运行机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/basic/11-execution/#单线程" class="sidebar-link">单线程</a></li><li class="sidebar-sub-header"><a href="/blog/basic/11-execution/#任务队列" class="sidebar-link">任务队列</a></li><li class="sidebar-sub-header"><a href="/blog/basic/11-execution/#事件循环" class="sidebar-link">事件循环</a></li><li class="sidebar-sub-header"><a href="/blog/basic/11-execution/#异步任务分类" class="sidebar-link">异步任务分类</a></li></ul></li><li><a href="/blog/basic/12-performance/" class="sidebar-link">性能优化</a></li><li><a href="/blog/basic/13-errorhandling/" class="sidebar-link">错误捕获</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js-运行机制"><a href="#js-运行机制" class="header-anchor">#</a> JS 运行机制</h1> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>单线程？任务队列？事件循环？</p></div> <h2 id="单线程"><a href="#单线程" class="header-anchor">#</a> 单线程</h2> <p>在 JS 引擎中，解析执行 JS 代码的调用栈是唯一的，所有的 JS 代码都在这一个调用栈里按照调用顺序执行，不能同时执行多个函数，调用栈遵循 LIFO(last in first out 后进先出)的规则，只有栈顶的函数处理完成后出栈，后面的函数再进入栈顶被执行。</p> <h2 id="任务队列"><a href="#任务队列" class="header-anchor">#</a> 任务队列</h2> <p>由于 JS 引擎的单线程设定同一时间只能执行一个任务，所有的任务都需要排队等待被引擎执行，所以如果其中某个任务耗时很长，后面的任务就必须一直等待，为解决这一问题，设计者将所有任务分为两种，同步与异步。</p> <p>同步任务：在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务。</p> <p>异步任务：不进入主线程、而进入&quot;任务队列&quot;（task queue）的任务，只有&quot;任务队列&quot;通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。</p> <p>异步任务一般有：</p> <ul><li><code>setTimeout(fn, time)</code>、<code>setInterval(fn, time)</code> <ul><li>当 <code>time</code> 参数值缺省时，默认为 0</li> <li>当 <code>time</code> 指定的值小于 4 时，增加到 4，即至少需要 4 毫秒，此定时器才会进入任务队列</li></ul></li> <li>DOM 事件</li> <li>Ajax 异步与 Promise</li></ul> <p><strong>在所有同步任务执行完之前，任何的异步任务是不会执行的</strong></p> <h2 id="事件循环"><a href="#事件循环" class="header-anchor">#</a> 事件循环</h2> <p><em>异步任务的执行机制：</em></p> <ol><li>所有同步任务都在主线程上执行，形成一个执行栈(execution context stack)</li> <li>主线程之外，还存在一个&quot;任务队列&quot;(task queue)，只要异步任务有了运行结果，就在&quot;任务队列&quot;之中放置一个事件</li> <li>一旦&quot;执行栈&quot;中的所有同步任务执行完毕，系统就会读取&quot;任务队列&quot;，看看里面有哪些事件，那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行</li> <li>主线程不断重复上面的第三步</li></ol> <p><strong>主线程从&quot;任务队列&quot;中读取事件，这个过程是循环不断的，所以整个的这种运行机制又称为 Event Loop（事件循环）。只要主线程空了，就会去读取&quot;任务队列&quot;，这就是 JavaScript 的运行机制。</strong></p> <h2 id="异步任务分类"><a href="#异步任务分类" class="header-anchor">#</a> 异步任务分类</h2> <p>异步任务可以分为宏任务和微任务，宏任务队列可以有多个，微任务队列只有一个。</p> <p>宏任务: <code>script(整体代码)</code>，<code>setTimeout</code>，<code>setInterval</code>，<code>setImmediate</code>(Node)，<code>I/O</code>，<code>UI rendering</code>，<code>postMessage</code></p> <p>微任务: <code>new Promise().then(回调)</code>，<code>process.nextTick</code>，<code>Object.observe</code> (已废弃)，<code>MutationObserver</code> (html5 新特性)</p> <p>执行顺序：</p> <ol><li>由于执行代码入口都是全局任务 <code>script</code>，而全局任务属于宏任务，所以先执行宏任务。当栈为空，同步任务执行完毕时，会先执行微任务队列里的任务</li> <li>微任务队列里的任务全部执行完毕后，会读取宏任务队列中排队最前的任务</li> <li>执行宏任务的过程中，遇到微任务，依次加入微任务队列</li> <li>栈空后，再次读取微任务队列里的任务，依次类推</li></ol> <p><strong>当某个宏任务队列的中的任务全部执行完以后，会查看是否有微任务队列。如果有，先执行微任务队列中的所有任务，如果没有，就查看是否有其他宏任务队列</strong></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2/11/2020, 5:38:40 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/basic/10-rendering/" class="prev">渲染机制</a></span> <span class="next"><a href="/blog/basic/12-performance/">性能优化</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.53d50016.js" defer></script><script src="/blog/assets/js/2.3ec31b7f.js" defer></script><script src="/blog/assets/js/11.e22e742b.js" defer></script>
  </body>
</html>

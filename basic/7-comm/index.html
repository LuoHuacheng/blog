<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前后端通信 | HC的前端之旅</title>
    <meta name="description" content="Javascript, HTML, CSS, Vue, React, Flutter, NodeJs, 前端技术">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.694c5b74.css" as="style"><link rel="preload" href="/blog/assets/js/app.f7a6eb13.js" as="script"><link rel="preload" href="/blog/assets/js/2.3ec31b7f.js" as="script"><link rel="preload" href="/blog/assets/js/20.cbf1a5a7.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.fc1d60c3.js"><link rel="prefetch" href="/blog/assets/js/11.523c4634.js"><link rel="prefetch" href="/blog/assets/js/12.abca864f.js"><link rel="prefetch" href="/blog/assets/js/13.5b50d4ca.js"><link rel="prefetch" href="/blog/assets/js/14.e0edb64a.js"><link rel="prefetch" href="/blog/assets/js/15.7980f798.js"><link rel="prefetch" href="/blog/assets/js/16.13dc343f.js"><link rel="prefetch" href="/blog/assets/js/17.506430c8.js"><link rel="prefetch" href="/blog/assets/js/18.c954377e.js"><link rel="prefetch" href="/blog/assets/js/19.0422c799.js"><link rel="prefetch" href="/blog/assets/js/21.b191e9df.js"><link rel="prefetch" href="/blog/assets/js/22.86120225.js"><link rel="prefetch" href="/blog/assets/js/23.1d5f6c09.js"><link rel="prefetch" href="/blog/assets/js/24.3b3d7083.js"><link rel="prefetch" href="/blog/assets/js/25.0c55a03b.js"><link rel="prefetch" href="/blog/assets/js/26.f5adbea6.js"><link rel="prefetch" href="/blog/assets/js/27.f7ccc17d.js"><link rel="prefetch" href="/blog/assets/js/28.d5d129ed.js"><link rel="prefetch" href="/blog/assets/js/29.15e86219.js"><link rel="prefetch" href="/blog/assets/js/3.2dbd99d4.js"><link rel="prefetch" href="/blog/assets/js/30.20c57fc2.js"><link rel="prefetch" href="/blog/assets/js/31.93c96ddb.js"><link rel="prefetch" href="/blog/assets/js/32.e43dcd71.js"><link rel="prefetch" href="/blog/assets/js/33.486a0696.js"><link rel="prefetch" href="/blog/assets/js/4.d168f381.js"><link rel="prefetch" href="/blog/assets/js/5.e8637279.js"><link rel="prefetch" href="/blog/assets/js/6.e2e543f3.js"><link rel="prefetch" href="/blog/assets/js/7.23803295.js"><link rel="prefetch" href="/blog/assets/js/8.15296b6c.js"><link rel="prefetch" href="/blog/assets/js/9.9e1c656a.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.694c5b74.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">HC的前端之旅</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/basic/" class="nav-link router-link-active">基础</a></div><div class="nav-item"><a href="/blog/advanced/" class="nav-link">进阶</a></div><div class="nav-item"><a href="/blog/frame/" class="nav-link">框架</a></div><div class="nav-item"><a href="/blog/other/" class="nav-link">其他</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/basic/" class="nav-link router-link-active">基础</a></div><div class="nav-item"><a href="/blog/advanced/" class="nav-link">进阶</a></div><div class="nav-item"><a href="/blog/frame/" class="nav-link">框架</a></div><div class="nav-item"><a href="/blog/other/" class="nav-link">其他</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>页面布局</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/basic/1-layout/center.html" class="sidebar-link">元素居中</a></li><li><a href="/blog/basic/1-layout/column.html" class="sidebar-link">多栏布局</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>盒模型</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog/basic/3-event/" class="sidebar-link">DOM事件</a></li><li><a href="/blog/basic/4-http/" class="sidebar-link">HTTP</a></li><li><a href="/blog/basic/5-prototype/" class="sidebar-link">原型/原型链</a></li><li><a href="/blog/basic/6-oop/" class="sidebar-link">面向对象</a></li><li><a href="/blog/basic/7-comm/" class="active sidebar-link">前后端通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/basic/7-comm/#同源策略及限制" class="sidebar-link">同源策略及限制</a></li><li class="sidebar-sub-header"><a href="/blog/basic/7-comm/#前后端通信方法" class="sidebar-link">前后端通信方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/basic/7-comm/#ajax" class="sidebar-link">Ajax</a></li><li class="sidebar-sub-header"><a href="/blog/basic/7-comm/#websocket" class="sidebar-link">WebSocket</a></li><li class="sidebar-sub-header"><a href="/blog/basic/7-comm/#cors" class="sidebar-link">CORS</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/basic/7-comm/#跨域通信" class="sidebar-link">跨域通信</a></li></ul></li><li><a href="/blog/basic/8-security/" class="sidebar-link">web安全</a></li><li><a href="/blog/basic/9-algorithm/" class="sidebar-link">算法</a></li><li><a href="/blog/basic/10-rendering/" class="sidebar-link">渲染机制</a></li><li><a href="/blog/basic/11-execution/" class="sidebar-link">JS执行机制</a></li><li><a href="/blog/basic/12-performance/" class="sidebar-link">性能优化</a></li><li><a href="/blog/basic/13-errorhandling/" class="sidebar-link">错误捕获</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前后端通信"><a href="#前后端通信" class="header-anchor">#</a> 前后端通信</h1> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>前后端通信方法有哪些？同源与跨域？</p></div> <h2 id="同源策略及限制"><a href="#同源策略及限制" class="header-anchor">#</a> 同源策略及限制</h2> <p>同源是指域名、端口与协议全都相同。</p> <p>非同源通信会存在以下限制：</p> <ol><li>Cookie、LocalStorage、IndexDB 无法获取</li> <li>DOM 无法获取与操作</li> <li>Ajax 不能发送，只适用于同源通信</li></ol> <h2 id="前后端通信方法"><a href="#前后端通信方法" class="header-anchor">#</a> 前后端通信方法</h2> <h3 id="ajax"><a href="#ajax" class="header-anchor">#</a> Ajax</h3> <p>Asynchronous JavaScript and XML 同源通信</p> <ol><li>创建 XMLHTTPRequest 对象 xhr = new XMLHttpRequest()<br>
兼容 IE：new window.ActiveXObject('Microsoft.XMLHTTP')</li> <li>使用 open 方法设置请求的参数：xhr.open(method, url, 是否异步)<br>
GET 与 POST 传输数据格式以及请求头设置<br>
xhr.setRequestHeader('Content-Type': 'application/x-www-form=urlencoded')</li> <li>发送请求 xhr.send()</li> <li>注册事件 xhr.onreadystatechange 事件监听请求的状态 xhr.readyState 和 xhr.status</li> <li>获取返回的数据并操作</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> options<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
  <span class="token keyword">const</span> method <span class="token operator">=</span> options<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">toLocaleLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'get'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> async <span class="token operator">=</span> options<span class="token punctuation">.</span>async <span class="token operator">!=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// default is true</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> options<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">let</span> xhr<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//如果是IE5或者IE6浏览器，则使用ActiveX对象</span>
    xhr <span class="token operator">=</span> <span class="token function">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">'Microsoft.XMLHTTP'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> paramArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> encodeData<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 参数拼接需要通过 encodeURIComponent 进行编码</span>
      paramArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
        <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    encodeData <span class="token operator">=</span> paramArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'get'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 检测 url 中是否已存在 ? 及其位置</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> url <span class="token operator">+=</span> <span class="token string">'?'</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">!==</span> url<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> url <span class="token operator">+=</span> <span class="token string">'&amp;'</span><span class="token punctuation">;</span>
    <span class="token comment">// 拼接 url</span>
    url <span class="token operator">+=</span> encodeData<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> async<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'get'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// post 方式需要设置请求头</span>
    xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span>
      <span class="token string">'Content-Type'</span><span class="token punctuation">,</span>
      <span class="token string">'application/x-www-form-urlencoded;charset=UTF-8'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>encodeData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">ajax</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token string">'api'</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    async<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">callback</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="websocket"><a href="#websocket" class="header-anchor">#</a> WebSocket</h3> <p>不受同源策略限制</p> <p>特点:</p> <ul><li>基于 TCP 协议，服务端易实现</li> <li>与 HTTP 协议兼容性好，默认端口为 80 和 443，握手阶段采用 HTTP 协议</li> <li>数据格式轻量、性能开销小、通信高效</li> <li>可发送文本，也可发送二进制数据</li> <li>无同源限制，客户端可以与任意服务器通信</li> <li>协议标识为 ws 或 wss</li> <li>服务器可主动向客户端发送数据</li></ul> <p>客户端实现：</p> <ol><li>创建 WebSocket 对象：<code>ws = new WebSocket(url)</code></li> <li>打开连接：<code>ws.open = fn(e){}</code></li> <li>接收信息：<code>ws.onmessage = fn(e){}</code></li> <li>关闭连接：<code>ws.onclose = fn(e){}</code></li> <li>错误捕获：<code>ws.onerror = fn(e){}</code></li></ol> <h3 id="cors"><a href="#cors" class="header-anchor">#</a> CORS</h3> <p>Corss-Origin Resource Sharing 支持跨域与同源</p> <p>简单请求：</p> <ul><li>GET、HEAD、POST</li> <li>Accept、Accept-Language、Content-Language</li> <li>Content-Type：application/x-www-form-urlencoded、multipart/form-data、text\plain</li></ul> <p>非简单请求：</p> <ul><li>OPTIONS 方法发起预请求以获知服务器是否允许该实际请求</li> <li>预检请求对 JS 是透明的，JS 无法获取预检请求的任何信息</li> <li>预检请求不是每次都发生，可以在服务端设置 Access-Control-Max-Age 来控制预检请求的有效期，有效期内不再发送</li></ul> <p>携带身份凭证(token)的请求:</p> <ul><li>CORS 默认不带身份凭证，需要前端设置 withCredentials=true 来使请求发送凭据</li> <li>附带凭证后
<ol><li>服务端 Access-Control-Allow-Origin 不能设置为 *</li> <li>服务端 Access-Control-Allow-Credentials 需要设置为 true</li></ol></li></ul> <h2 id="跨域通信"><a href="#跨域通信" class="header-anchor">#</a> 跨域通信</h2> <ul><li><p>JSONP(JSON Padding)</p> <ul><li>利用 <em>script</em> 标签跨域，由服务端返回预先设定好的全局函数的调用，并将服务端数据以参数传递</li> <li>只能用于 GET 请求，且在接收数据处理完后要删除这个全局变量</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>
  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/api?jsoncallback=callbackFunction<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">callbackFunction</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>Hash</p> <ul><li>利用 Hash 改变后页面不会刷新的特点跨域</li> <li>A 页面将要改善的数据转换为 JSON 字符串发给 B 页面，<code>B.src = B.src + '#' + 'jsonString';</code></li> <li>B 页面监听 hash 变化取得数据，<code>var data = window.location.hash;</code></li> <li>数据长度有限制，由浏览器地址栏长度限制</li></ul></li> <li><p>WebSocket</p></li> <li><p>CORS</p></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2/10/2020, 12:48:58 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/basic/6-oop/" class="prev">面向对象</a></span> <span class="next"><a href="/blog/basic/8-security/">web安全</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.f7a6eb13.js" defer></script><script src="/blog/assets/js/2.3ec31b7f.js" defer></script><script src="/blog/assets/js/20.cbf1a5a7.js" defer></script>
  </body>
</html>
